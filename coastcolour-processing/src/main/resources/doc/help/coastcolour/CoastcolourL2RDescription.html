<!--
  ~ Copyright (C) 2013 Brockmann Consult GmbH (info@brockmann-consult.de)
  ~
  ~ This program is free software; you can redistribute it and/or modify it
  ~ under the terms of the GNU General Public License as published by the Free
  ~ Software Foundation; either version 3 of the License, or (at your option)
  ~ any later version.
  ~ This program is distributed in the hope that it will be useful, but WITHOUT
  ~ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  ~ FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
  ~ more details.
  ~
  ~ You should have received a copy of the GNU General Public License along
  ~ with this program; if not, see http://www.gnu.org/licenses/
  -->

<html>
<head>
    <title>CoastColour Atmospheric Correction</title>
    <link rel="stylesheet" href="../style.css">
</head>

<body>

<table class="header">
    <tr class="header">
        <td class="header">&nbsp;
            Atmospheric Correction
        </td>
        <td class="header" align="right"><a href="../general/BeamOverview.html"><img src="../images/BeamHeader.jpg"
                                                                                     border=0></a>
        </td>
    </tr>
</table>

<!-------- Atmospheric Correction --------------------------------------->
<h3>Atmospheric Correction</h3>

<h4>I/O Parameters</h4>

<p>
    Selecting the <b>CoastColour Processors (MERIS)...</b> entry from the VISAT
    'Processing --> Thematic Water Processing' sub-menu opens another
    sub-menu with the three entries 'Pre-Processing and Pixel Classification...',
    'Atmospheric Correction...', and 'In-Water Processing...'. Selecting 'Atmospheric Correction...'
    from this sub-menu pops up the 'Atmospheric Correction' dialog:
</p>

<p align="center">
    <img src="images/CoastcolourL2RProcessingDialog_io.png" alt="Coastcolour L2R Processing Dialog"/>
</p>

<h5>Source Products</h5>

<p class="i1">
    <b>CC L1P or MERIS L1B product:</b>

    <p>
        Here the user specifies the CC L1P or the MERIS L1b source product.
        A 'CC L1P' product is the result product of a previous CoastColour L1P
        'Pre-Processing and Pixel Classification' step. If the source product
        is a MERIS L1b product, that step will be automatically carried out internally
        before the L2R 'Atmospheric Correction' step. However, in that case,
        no intermediate CC L1P product, but only an L2R target product will be produced.
    </p>
    <p>
        The combo box presents
        a list of all products open in VISAT. The user may select one of these
        or, by clicking on the button next to the combo box, choose a product
        from the file system.
    </p>
</p>

<h5>Target Product Group</h5>

<p class="i1">
    <b>Name:</b>
    Used to specify the name of the target product.
</p>

<p class="i1">
    <b>Save to:</b>
    Used to specify whether the target product should be saved to the file system. The
    combo box presents a list of file formats, currently BEAM-DIMAP, GeoTIFF, and HDF5.
</p>

<p class="i1">
    <b>Open in VISAT:</b>
    Used to specify whether the target product should be opened in VISAT. When the
    the target product is not saved, it is opened in VISAT automatically.
</p>


<h4>Processing Parameters</h4>

<p>
    Selecting the <b>Processing Parameters</b> tab in the
    'Atmospheric Correction' dialog switches to the following view:
</p>

<p align="center">
    <img src="images/CoastcolourL2RProcessingDialog_procparms.png" alt="Coastcolour L2R Processing Parameters"/>
</p>

<h5>Parameters</h5>

<p>
    TODO!!
</p>

<p class="i1">
    <b>[L1P]...:</b>
    All options starting with '[L1P]...' have the same meaning as described in the documentation for the
    L1P ''Pre-Processing and Pixel Classification'' processing. These parameters have effect only if an L1P
    processing step will be performed in
    advance (i.e. if the source product is not a CC L1P but a MERIS L1B product).
</p>

<p class="i1">
    <b>Use climatology map for salinity and temperature:</b>
    By default a climatology map is used. If this checkbox is not selected, the specified average values (see below)
    are used for the whole scene.
</p>

<p class="i1">
    <b>Average salinity:</b>
    This is the salinity average value if no climatology map is used.
</p>

<p class="i1">
    <b>Average temperature:</b>
    This is the temperature average value if no climatology map is used.
</p>

<p class="i1">
    <b>Use NNs for extreme ranges of coastcolour IOPs:</b>
    If this checkbox is selected, a special set of NNs will be used to finally derive water IOPs in extreme ranges.
</p>

<p class="i1">
    <b>Land detection expressions:</b>
    This is the arithmetic expression used for land detection.
</p>

<p class="i1">
    <b>Cloud/ice detection expressions:</b>
    This is the arithmetic expression used for cloud/ice detection.
</p>

<p class="i1">
    <b>Write TOA reflectances to the CC L2R target product:</b>
    This checkbox indicates if the TOA reflectances shall be written to the CC L2R target product.
</p>

<p class="i1">
    <b>Write water leaving reflectances:</b>
    This menu indicates if the water leaving reflectances shall be written as radiances or irradiances.
    The irradiances ( = radiances multiplied by PI) are compatible with the standard MERIS product.
</p>

<br>


<h4>Flag Codings</h4>

<h5>CC L2R target product</h5>

<p>
    In addition to the 'l1_flags' and the 'l1p_flags', the CC L2R target product provides another
    flag band 'l2r_flags' with a coding as shown below:
</p>

<p align="center">
    <img src="images/l2r_flags.png" alt="File Menu"/>
</p>


<h4>Menu Bar</h4>
<h5>'File' Menu</h5>

<p>
    Selecting the <b>File</b> entry in the Menu Bar opens the following view:
</p>

<p align="center">
    <img src="images/file_menu.png" alt="File Menu"/>
</p>

<p class="i1">
    <b>Open Parameters...:</b>
    When this entry is selected, an 'Open File' dialog will appear.
    Here, a BEAM GPF parameters XML file can be selected, containing
    'Atmospheric Correction' parameters which were saved earlier.
    These parameters will be loaded and applied for an upcoming processing.
</p>

<p class="i1">
    <b>Save Parameters...:</b>
    When this entry is selected, a 'Save File' dialog will appear.
    Here, the current set of 'Atmospheric Correction' parameters can be saved into a
    BEAM GPF parameters XML file for later re-usage.
</p>

<p class="i1">
    <b>Display Parameters...:</b>
    When this entry is selected, the current set of 'Atmospheric Correction' parameters
    will be displayed in XML format (see below).
</p>

<p align="center">
    <img src="images/l2r_file_menu_display_params.png" alt="L2R File Menu Display Parms"/>
</p>


<h5>'Help' Menu</h5>

<p>
    Selecting the <b>Help</b> entry in the Menu Bar opens the following view:
</p>

<p align="center">
    <img src="images/help_menu.png" alt="Help Menu"/>
</p>

<p class="i1">
    <b>Help:</b>
    When this entry is selected, this online help is opened
    in a separate window.
</p>

<p class="i1">
    <b>About...:</b>
    When this entry is selected, an 'About' dialog for the current
    processor is opened (see below).
</p>

<p align="center">
    <img src="images/l2r_help_menu_about.png" alt="L2R Help Menu About"/>
</p>


<h4>Button Group</h4>

<p align="center">
    <img src="images/button_group.png" alt="Button Group"/>
</p>

<p class="i1">
    <b>Run:</b>
    When this button is clicked, the processing will be started with the selected
    parameters.
</p>

<p class="i1">
    <b>Close:</b>
    When this button is clicked, the processor tool window will be closed.
</p>


<br>
<hr>

<!-------- Command line --------------------------------------->
<h3>Processing from Command Line</h3>

Since the CoastColour processors make use of the BEAM graph processing framework, they can be
used also with the 'gpt' command line tool outside BEAM-VISAT. The graph processing is invoked
by the command
<div class="itemizedlist">
    <ul type="bullet">
        <li style="list-style-type: disc">
            ${BEAM-INSTALL-DIR}/bin/gpt
        </li>
    </ul>
</div>

To obtain general help on the graph processing, use the command
<div class="itemizedlist">
    <ul type="bullet">
        <li style="list-style-type: disc">
            ${BEAM-INSTALL-DIR}/bin/gpt -h
        </li>
    </ul>
</div>

Specific help on the 'Atmospheric Correction' can be obtained with
<div class="itemizedlist">
    <ul type="bullet">
        <li style="list-style-type: disc">
            ${BEAM-INSTALL-DIR}/bin/gpt -h CoastColour.L2R
        </li>
    </ul>
</div>
Information on the usage and a list of all available parameters are given.

<p align="center">
    <img src="images/gpt_cc_l2r.png" alt="CC L2R parameters"/>
</p>
<br>

<br><br>
The processing from the command line can also be invoked using graph XML files.
For example, a CoastColour atmospheric correction could be started with
<div class="itemizedlist">
    <ul type="bullet">
        <li style="list-style-type: disc">
            ${BEAM-INSTALL-DIR}/bin/gpt test_cc_l2r.xml -SccL2R=./MER_CC_l1p_test.dim

        </li>
    </ul>
</div>
with a CoastColour L1P input file 'MER_cc_l1p_test.dim'
(processed earlier in a 'pre-processing and pixel classification' step, given in BEAM Dimap format)
in the current directory, and a graph XML file 'test_cc_l2r.xml' in the XML format as shown in the figure above.

</body>
</html>
